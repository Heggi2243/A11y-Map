rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    function isManager() {
      let allowedUIDs = [
        "TKJqrWGdmoPtaZuDmSLOUtTAzqK2",
        "bwYPuwjyX9VTDSVYw5THhFW7xAg2"
      ];
      return request.auth != null && request.auth.uid in allowedUIDs;
    }
    
    // ğŸ”’ å¼·åŒ–ï¼šlogin_sessions åªèƒ½å¯«å…¥è‡ªå·±çš„è³‡æ–™
    match /login_sessions/{sessionId} {
      // åªèƒ½è®€å–è‡ªå·±çš„ session
      allow read: if isManager() && request.auth.uid == resource.data.uid;
      
      // åªèƒ½å‰µå»ºè‡ªå·±çš„ sessionï¼Œä¸”å¿…é ˆåŒ…å«å¿…è¦æ¬„ä½
      allow create: if request.auth != null 
                    && request.resource.data.uid == request.auth.uid
                    && request.resource.data.keys().hasAll(['uid', 'email', 'loginTime', 'status']);
      
      // åªèƒ½æ›´æ–°è‡ªå·±çš„ session ç‹€æ…‹
      allow update: if request.auth != null 
                    && request.auth.uid == resource.data.uid
                    && request.resource.data.uid == resource.data.uid;  // ä¸èƒ½æ”¹ uid
      
      allow delete: if false;  // ä¸å…è¨±åˆªé™¤
    }
    
    // ç®¡ç†å“¡åˆ—è¡¨æŸ¥è©¢ï¼ˆéœ€è¦ç‰¹æ®Šè™•ç†ï¼‰
    match /login_sessions/{sessionId} {
      allow list: if isManager();  // ç®¡ç†å“¡å¯ä»¥åˆ—å‡ºæ‰€æœ‰ sessions
    }
    
    match /stores/{storeId} {
      allow read: if true; 
      allow write, delete: if isManager(); 
      // allow read,write : if true; 
    }
    
    match /admin_data/{document} {
      allow read, write: if isManager(); 
    }
  }
}